extern crate mandelrust;
extern crate graphics;
extern crate glium;
extern crate glium_graphics;
extern crate shader_version;
extern crate piston;
extern crate glutin_window;
#[macro_use(lift)]
extern crate carboxyl;
extern crate carboxyl_window;
extern crate benzene;
#[macro_use]
extern crate rust_mpfr;
extern crate image;
extern crate palette;
extern crate input;
extern crate rayon;
extern crate num;

mod driver;
pub mod mandelbrot;
mod app;

use driver::Driver2d;
use mandelbrot::{CanvasSize};
use piston::window::WindowSettings;
use benzene::{Driver, Component, interpret, start};

fn settings() -> WindowSettings {
    WindowSettings::new("Mandelrust", (900, 600))
}

fn main() {
    let x = mpfr!(-1.76870695318726651071950263928143062352581392950029771945562562581784034492593119464925257051353413657830156260917461241276335535649981545679545736655853251171199524334998581456239724542574419777079205190177147490373943683285987419337879733443298267355851315274206640605705174555989962722897028381480137802491466571592505361450504243256343641174948787082156227086080294867583590933731248687671280178560301882371844573633356199814878977152262848188245017487918528481689455014118193830986122694827641882984308576488723653486095963827510257438324709156000697160063026348906541518854803772232280886632465875786226189123593291497030204166229665725956042858548418152921471284669610634801745187587835560749469826570221738994691872187767571667414679401040969123371288316744806709490565969974431712412570342563215339366098904335626868758867647382203217885548035063474117619658987806477400777197162891045562186934637036762457065900576533346445265077180881214641450683133575150605635888672753519133542583711383659813252053119975253152066855877860927853504163986111254836472194669356821226207129866636326058152564418447900420232504583830586671527158776086472332275088714703282795141391088165063659447659313463169692055725314235551425589244724856884973346731107837246038225623216885755492359906105382788066212421438898685999358208800716374669763075537366368426884621101712973691744674107965353428121177515481511985454902841774145267354198232731768065819290951677105680466513879683619269866174264217264908674968);
    let y = mpfr!(0.001868686686227988176130647307954581508738167583241449594716411559442405823121907080502676042747857508864983482317973130691197660837071980974463386829023450956816419035472729241968147136038655416649513807918826476184141064623044345761258934907923188810218745973026017186068977792186139267069265948219623392838074094758283508230788329101339978857654290763104425692931844188628579185770243922235247035097681000878621244306196662887666872253743601364311317187692676927193485870160729088183874147928487038905845025520503532277860797246786502456899005589795155946619149915092880959068172765996323061010540701593015099308586902493625429647848069092926867759532660949705951078950966939838343952812860634555039320332305822122714116655082225129113526915941349723219983577490471343626189988194391345128462711972842837972035119906335443649653543303937589200566904750428612132741618094213054900852011695246182656068813413252349739757629813513494688243111109092164614085452841753527019142475555673714999708817964274540342353340888392763732368602107455545847766681115431077145688515721980166325144995726552640452348813586550410280818205793652420923535585017913232463524001680557077721395980696650689327248784953180290223662467703875909629516622636345641462569651601297955058493641113751159431336774175869545781115831687883290497383258974387108177826464303026888239498456809908053358231699596850891841254380062352159231787514633720701218752312857956054650723666381122127068211517697387814838645987294552414086280000000000000000000000000000000000);
    let zoom = mpfr!(6.2726136824206070700569600396441e1489);
    println!("{}", y.get_prec());
    let canvas = CanvasSize::new_from_center(900, 600, [x, y], zoom);
    let max = 1000u32;

    let mut driver2d = Driver2d::new(settings());

    let output = start(
        Component {
            init: app::init(canvas, max),
            update: app::update,
            view: app::view,
            effect: |_, _| None
        },
        interpret(driver2d.output(), app::intent)
    );

    driver2d.run(output);
}
